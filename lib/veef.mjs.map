{"version":3,"file":"example-bundle.js.map","sources":["veef.js"],"sourcesContent":["const createElement = (name, component) => {\r\n    let opts = null;\r\n\r\n    customElements.define(name, class extends HTMLElement {\r\n        constructor() {\r\n            super()\r\n            this._r = this.attachShadow(opts || {mode: 'open'})\r\n        }\r\n        connectedCallback() {\r\n            const root = this._r\r\n            let rerender = () => {\r\n                let prevFns = state._renderHandlers\r\n                state._reset()\r\n                let newVdom = wrapStyle(component(state))\r\n                diff(lastVdom, newVdom, root)\r\n                lastVdom = newVdom;\r\n                prevFns.map(x => x(root))\r\n            }\r\n            let state = {\r\n                _css: '',\r\n                _hookCnt: 0,\r\n                _renderHandlers: [],\r\n                _reset: () => {\r\n                    state._css = ''\r\n                    state._hookCnt = 0\r\n                    state._renderHandlers = []\r\n                },\r\n                _data: {},\r\n                addStyle: (x) => state._css += x,\r\n                slot: (name, data) => { DOM_SLOT.n = name; return DOM_SLOT }, \r\n                ref: (name) => refCache[name],\r\n                add: (defaultVal) => {\r\n                    let key = ++state._hookCnt\r\n                    const set = (x) => { state._data[key] = x; rerender() }\r\n                    if(key in state._data) return {val: state._data[key], set}\r\n                    state._data[key] = defaultVal\r\n                    return {val: defaultVal, set}\r\n                },\r\n                onRender: (cb) => {\r\n                    state._renderHandlers.push(cb)\r\n                },\r\n            }\r\n            const wrapStyle = (vdom) => {\r\n                const styleTag = newTag('style')\r\n                styleTag.children[0] = state._css;\r\n                vdom.children.unshift(styleTag)\r\n                return vdom\r\n            }\r\n            let lastVdom = wrapStyle(component(state))\r\n            root.append(render(lastVdom))\r\n            state._renderHandlers.map(x => x(root))\r\n        }\r\n        /*disconnectedCallback() {\r\n        }\r\n        attributeChangedCallback(name, from, to) {\r\n            console.log(name, from,to)\r\n        }\r\n        */\r\n    })\r\n}\r\nconst render = (vdom) => {\r\n    if(vdom.charAt) return document.createTextNode(vdom);\r\n    let name = vdom.name\r\n    if(name == 'root') name = 'div'\r\n    let newEl = document.createElement(name);\r\n    if(name == 'slot') newEl.name = vdom.n;\r\n    setElementProps(vdom.props, newEl)\r\n    newEl.append(...vdom.children.map(x => render(x)));\r\n    return newEl\r\n};\r\nconst _diff = (vdom1, vdom2, domNode, parentNode) => {\r\n    if(isUndef(vdom2)) { // new vDOM removes a node\r\n        if(domNode) domNode.remove()\r\n        return\r\n    }\r\n    if(isUndef(vdom1)) { // node didn't exist before\r\n        if(vdom2) parentNode.append(render(vdom2))\r\n        return\r\n    }\r\n    if(!vdom2.el || !vdom1.el) { // check if nodes aren't element (TextNode)\r\n        if(vdom1 !== vdom2) {\r\n            domNode.replaceWith(render(vdom2))\r\n            return\r\n        }\r\n        return\r\n    }\r\n    if(vdom1.name != vdom2.name) { // check if different tag names\r\n        domNode.replaceWith(render(vdom2))\r\n        return\r\n    }\r\n\r\n    /* Filter differing props old -> new */\r\n    const findOldProp = (prop) => vdom1.props.find(x=>x[0]==prop[0])[1];\r\n    setElementProps(vdom2.props.filter(x => x[1] != findOldProp(x)), domNode)\r\n\r\n\tfor(let i = 0;;i++) {\r\n\t\tconst v1 = vdom1.children[i], v2 = vdom2.children[i]\r\n\t\tif(isUndef(v1) && isUndef(v2)) break\r\n\t\t_diff(v1, v2, domNode.childNodes[i], domNode)\r\n\t}\r\n}\r\n\r\nconst diff = (vdom1, vdom2, w) => _diff(vdom1, vdom2, w.children[0])\r\n\r\n// Construct an empty virtual <tag>\r\n/*@__PURE__*/\r\nconst newTag = (ch) => ( {name: ch, props: [], children: [''], x:0, el:1 });\r\n\r\nconst DOM_SLOT = {};\r\n\r\nconst h = (strings, ...argums) => {\r\n    const TAG_NAME = 0, PROPS_START = 1, INNER_TEXT = 2;\r\n    const PROP_NAME=6, PROP_EQUALS=7, PROP_Q1=8, PROP_Q2=9, EARLY=10;\r\n    const FUNC = 15;\r\n\r\n    const AUTOCLOSE = ['br', 'hr', 'img', 'input'];\r\n\r\n    const addDomSlot = (name) => {\r\n        const slotTag = newTag('slot')\r\n        slotTag.n = name || '';\r\n        tag[children].push(slotTag)\r\n    }\r\n\r\n    let tag = newTag('root');\r\n    let root = tag;\r\n    let chr = null;\r\n    let stage = 2;\r\n\r\n    const tagStack = [tag];\r\n\r\n    const children = 'children'\r\n    const _put = (x) => tag[children].push(x)\r\n    const put = (x) => { tag.x=_put(x); _put('') }\r\n    const propPut = (x) => tag.props[0][1] += chr;\r\n\r\n    /* Run smart trim on all inner TextNodes and remove them if empty. */\r\n    const trimChildren = (node) => node.map(x => x.el ? x : preservingTrim(x)).filter(x => x!=='');\r\n\r\n    /* State machine for parsing JSX */\r\n    let transitions = {\r\n        [TAG_NAME]: {'>': INNER_TEXT, ' ': PROPS_START, '/':4, [FUNC]: () => {tag.name += chr} },\r\n        [PROPS_START]: {'>': INNER_TEXT, ' ': PROPS_START, '/': 4, [FUNC]: () => {\r\n            tag.props.unshift([chr, '']);\r\n            stage = PROP_NAME}},\r\n        [PROP_NAME]: {'=': PROP_EQUALS, [FUNC]: () => {tag.props[0][0]+= chr}},\r\n        [PROP_EQUALS]: {'\"': PROP_Q1, \"'\": PROP_Q2, [FUNC]: propPut},\r\n        [PROP_Q1]: {'\"': PROPS_START, [FUNC]: propPut},\r\n        [PROP_Q2]: {\"'\": PROPS_START, [FUNC]: propPut},\r\n        [INNER_TEXT]: {[FUNC]: () => {\r\n            if(chr == '<') {\r\n                tag[children] = trimChildren(tag[children])\r\n                stage = 3;\r\n                return\r\n            }\r\n            tag[children][tag.x] += chr\r\n        }},\r\n        3: {'/': 4, [FUNC]: () => {\r\n            const newEl = newTag(chr)\r\n            tagStack.push(tag)\r\n            put(newEl)\r\n            tag = newEl\r\n            stage = TAG_NAME\r\n        }},\r\n        4: {[FUNC]: () => {\r\n            if(chr != '>')  return; \r\n            tag = tagStack.pop()\r\n            stage = INNER_TEXT;\r\n        }}\r\n    };\r\n    let c = 0;\r\n    for(var i = 0;;i++) {\r\n        if(i >= strings[c].length) {\r\n            if(c >= argums.length) break;\r\n            const arg = argums[c];\r\n            if(stage == PROP_NAME || stage == PROP_EQUALS) {\r\n                tag.props[0][1] = arg;\r\n                stage = PROPS_START;\r\n            }\r\n            if(stage == 2) {\r\n                if(arg === DOM_SLOT) addDomSlot(DOM_SLOT.n)\r\n                else\r\n                    put(arg.toString())\r\n            }\r\n            i = 0; c++;\r\n            if(isUndef(strings[c][0])) break;\r\n        }\r\n        chr  = strings[c][i]\r\n        if(stage == TAG_NAME || stage == PROPS_START) chr = chr.replace(/\\s/,' ')\r\n        let T = transitions[stage]\r\n        if(chr in T) stage = T[chr]\r\n        else T[FUNC]()\r\n    }\r\n    root[children] = trimChildren(root[children])\r\n    return root;\r\n}\r\n\r\nexport { h, createElement }\r\n\r\n/*@__PURE__*/\r\nconst isUndef = (x) => typeof x === 'undefined'\r\n\r\nlet eventHandlerCache = []\r\nlet refCache = {}\r\nconst setElementProps = (props, element) => {\r\n    const isEvent = (key) => key.substr(0, 2) == 'on'\r\n    const EV_NAME = 0;\r\n    const EL = 1;\r\n    const FN = 2;\r\n    props.map(x => {\r\n        const key = x[0]\r\n        const value = x[1]\r\n        if(key == 'class' && !value.trim) {\r\n            const cl = element.classList;\r\n            cl.forEach((v) => v in value ? null : value[v] = false)\r\n\r\n            for(var cls in value) !value[cls] ? cl.remove(cls) : cl.add(cls)\r\n            return\r\n        }\r\n        if(key == 'ref') {\r\n            refCache[value] = element\r\n            return\r\n        }\r\n        if(isEvent(key) && !value.trim) {\r\n            let evName = key.toLowerCase().substr(2)\r\n            eventHandlerCache.filter(h => h[EV_NAME] == evName && h[EL] == element).map(x => \r\n                element.removeEventListener(evName, x[FN])\r\n            );\r\n            eventHandlerCache.push({[EV_NAME]: evName, [EL]: element, [FN]: value})\r\n            element.addEventListener(evName, value)\r\n            return\r\n        }\r\n        element.setAttribute(key, value)\r\n    })\r\n}\r\n\r\n/*@__PURE__*/\r\nconst preservingTrim = (x) => {\r\n    /* \r\n     * Removes all but one whitespace.\r\n     * Needed for proper HTML word breaking.\r\n     * f('a')       =>  'a'\r\n     * f('  \\t  a') =>  '<space> a'\r\n     * f('  a  ')   =>  '<space> a <space>'\r\n     * */\r\n    if(x === '') return ''\r\n    let fullTrim = x.trim()\r\n    let l = '', r = '';\r\n    if(x[0] !== fullTrim[0]) l = ' ';\r\n    if(x.substr(-1) !== fullTrim.substr(-1)) r = ' ';\r\n    if(fullTrim == '' && l==r) return l\r\n    return l + fullTrim + r;\r\n};\r\n"],"names":["createElement","name","component","customElements","define","HTMLElement","constructor","super","this","_r","attachShadow","mode","connectedCallback","root","state","_css","_hookCnt","_renderHandlers","_reset","_data","addStyle","x","slot","data","DOM_SLOT","n","ref","refCache","add","defaultVal","key","set","prevFns","newVdom","wrapStyle","diff","lastVdom","map","rerender","val","onRender","cb","push","vdom","styleTag","newTag","children","unshift","append","render","charAt","document","createTextNode","newEl","setElementProps","props","_diff","vdom1","vdom2","domNode","parentNode","isUndef","remove","el","replaceWith","filter","prop","find","i","v1","v2","childNodes","w","ch","h","strings","argums","FUNC","addDomSlot","slotTag","tag","chr","stage","tagStack","_put","put","propPut","trimChildren","node","preservingTrim","transitions","pop","c","length","arg","toString","replace","T","eventHandlerCache","element","value","trim","substr","isEvent","evName","toLowerCase","removeEventListener","addEventListener","setAttribute","cl","classList","cls","forEach","v","fullTrim","l","r"],"mappings":"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"}