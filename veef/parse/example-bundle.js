const e=(e,t)=>{customElements.define(e,class extends HTMLElement{constructor(){super(),this._root=this.attachShadow({mode:"open"})}connectedCallback(){let e=()=>{let e=n.renderFns;n.reset();let r=t(n);o(a,r,this._root),a=r,e.map((e=>e(this._root)))},n={hookCounter:0,renderFns:[],ref:e=>d[e],reset:()=>{n.hookCounter=0,n.renderFns=[]},_data:{},add:r=>{let t=++n.hookCounter;const o=r=>{n._data[t]=r,e()};return t in n._data?{value:n._data[t],set:o}:(n._data[t]=r,{value:r,set:o})},onRender:e=>{n.renderFns.push(e)}},a=t(n);this._root.append(r(a)),n.renderFns.map((e=>e(this._root)))}attributeChangedCallback(e,r,t){}})},r=e=>{if(e.charAt)return document.createTextNode(e);let t=e.name;"root"==t&&(t="div");let n=document.createElement(t);return e.props.map((e=>{u(e,n)||(n[e.name]=e.value)})),n.append(...e.children.map((e=>r(e)))),n},t=e=>"on"==e.name.substr(0,2),n=(e,o,a,l)=>{if(s(o))return void(a&&a.remove());if(s(e))return void(o&&l.append(r(o)));if(!o.el||!e.el)return e!==o?void a.replaceWith(r(o)):void 0;if(e.name!=o.name)return void a.replaceWith(r(o));o.props.filter((e=>!t(e)&&"ref"!=e.name&&e.value!=o.props[e.key])).map((e=>a[e.key]=e.value)),o.props.map((e=>u(e,a)));const i=r=>{r.children.map(((r,t)=>n(e.children[t],o.children[t],a.childNodes[t],a)))};i(o),i(e)},o=(e,r,t)=>n(e,r,t.children[0]),a=e=>({name:e,props:[],children:[""],x:0,el:1}),l=(e,...r)=>{const t=99;let n=a("root"),o=n,l=[n],i=null,d=2,u=e=>n.children.push(e),p=e=>{n.x=u(e),u("")},c=e=>n.props[0].value+=i;const h=e=>e.map((e=>e.el?e:(e=>{if(""===e)return"";let r=e.trim(),t="",n="";return e[0]!==r[0]&&(t=" "),e.substr(-1)!==r.substr(-1)&&(n=" "),""==r&&t==n?t:t+r+n})(e))).filter((e=>""!==e));let m={0:{">":2," ":1,"/":4,[t]:()=>{n.name+=i}},1:{">":2," ":1,"/":4,[t]:()=>{n.props.unshift({name:i,value:""}),d=6}},6:{"=":7,[t]:()=>{n.props[0].name+=i}},7:{'"':8,"'":9,[t]:c},8:{'"':1,[t]:c},9:{"'":1,[t]:c},2:{[t]:()=>{if("<"==i)return n.children=h(n.children),void(d=3);n.children[n.x]+=i}},3:{"/":4,[t]:()=>{const e=a(i);l.push(n),p(e),n=e,d=0}},4:{[t]:()=>{">"==i&&(n=l.pop(),d=2)}}},f=0;for(var v=0;;v++){if(v>=e[f].length){if(f>=r.length)break;const t=r[f];if(6!=d&&7!=d||(n.props[0].value=t,d=1),2==d&&p(t.toString()),v=0,f++,s(e[f][0]))break}i=e[f][v];let t=m[d];i in t?d=t[i]:t[99]()}return o.children=h(o.children),o};l.ref=e=>e;const s=e=>void 0===e;let i=[],d={};const u=(e,r)=>{if("ref"===e.name)return d[e.value]=r,!0;if("function"==typeof e.value&&t(e)){let t=e.name.toLowerCase().substr(2);return i.filter((e=>e.name==t&&e.el==r)).map((e=>r.removeEventListener(t,e.fn))),i.push({name:t,el:r,fn:e.value}),r.addEventListener(t,e.value),!0}return!1};export{l as h,e as newElement};
