const e=(e,r)=>{customElements.define(e,class extends HTMLElement{constructor(){super(),this._root=this.attachShadow({mode:"open"})}connectedCallback(){let e=()=>{let e=n.renderFns;n.reset();let t=r(n);o(a,t,this._root),a=t,e.map((e=>e(this._root)))},n={hookCounter:0,renderFns:[],reset:()=>{n.hookCounter=0,n.renderFns=[]},_data:{},add:t=>{let r=++n.hookCounter;const o=t=>{n._data[r]=t,e()};return r in n._data?{value:n._data[r],set:o}:(n._data[r]=t,{value:t,set:o})},onRender:e=>{n.renderFns.push(e)}},a=r(n);this._root.append(t(a)),n.renderFns.map((e=>e(this._root)))}attributeChangedCallback(e,t,r){}})},t=e=>{if(e.charAt)return document.createTextNode(e);let r=e.name;"root"==r&&(r="div");let n=document.createElement(r);return e.props.map((e=>{d(e,n)||(n[e.name]=e.value)})),n.append(...e.children.map((e=>t(e)))),n},r=e=>"on"==e.name.substr(0,2),n=(e,o,a,l)=>{if(s(o))return void(a&&a.remove());if(s(e))return void(o&&l.append(t(o)));if(!o.el||!e.el)return e!==o?void a.replaceWith(t(o)):void 0;if(e.name!=o.name)return void a.replaceWith(t(o));o.props.filter((e=>!r(e)&&e.value!=o.props[e.key])).map((e=>a[e.key]=e.value)),o.props.map((e=>d(e,a)));const i=(e,t)=>{e.children.map(((r,o)=>n(e.children[o],t.children[o],a.childNodes[o],a)))};i(o,e),i(e,o)},o=(e,t,r)=>n(e,t,r.children[0]),a=e=>({name:e,props:[],children:[""],x:0,el:1}),l=(e,...t)=>{const r=99;let n=a("root"),o=n,l=[n],i=null,d=2,p=e=>n.children.push(e),u=e=>{n.x=p(e),p("")},c=e=>n.props[0].value+=i;const h=e=>e.map((e=>e.el?e:(e=>{if(""===e)return"";let t=e.trim(),r="",n="";return e[0]!==t[0]&&(r=" "),e.substr(-1)!==t.substr(-1)&&(n=" "),""==t&&r==n?r:r+t+n})(e))).filter((e=>""!==e));let m={0:{">":2," ":1,"/":4,[r]:()=>{n.name+=i}},1:{">":2," ":1,"/":4,[r]:()=>{n.props.unshift({name:i,value:""}),d=6}},6:{"=":7,[r]:()=>{n.props[0].name+=i}},7:{'"':8,"'":9,[r]:c},8:{'"':1,[r]:c},9:{"'":1,[r]:c},2:{[r]:()=>{if("<"==i)return n.children=h(n.children),void(d=3);n.children[n.x]+=i}},3:{"/":4,[r]:()=>{const e=a(i);l.push(n),u(e),n=e,d=0}},4:{[r]:()=>{">"==i&&(n=l.pop(),d=2)}}},v=0;for(var f=0;;f++){if(f>=e[v].length){if(v>=t.length)break;const r=t[v];if(6!=d&&7!=d||(n.props[0].value=r,d=1),2==d&&u(r.toString()),f=0,v++,s(e[v][0]))break}i=e[v][f];let r=m[d];i in r?d=r[i]:r[99]()}return o.children=h(o.children),o};l.ref=e=>e;const s=e=>void 0===e;let i=[];const d=(e,t)=>{if("function"==typeof e.value&&r(e)){let r=e.name.toLowerCase().substr(2);return i.filter((e=>e.name==r&&e.el==t)).map((e=>t.removeEventListener(r,e.fn))),i.push({name:r,el:t,fn:e.value}),t.addEventListener(r,e.value),!0}return!1};export{l as h,e as newElement};
